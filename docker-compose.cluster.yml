version: '3.8'

# 3-node Bolt cluster configuration
# Usage: docker-compose -f docker-compose.cluster.yml up -d

services:
  bolt-node1:
    build: .
    image: bolt:latest
    container_name: bolt-node1
    hostname: bolt-node1
    ports:
      - "2012:2012"   # Client port
      - "2013:2013"   # Cluster port
      - "9091:9091"   # Metrics port
    volumes:
      - bolt_node1_data:/data
    environment:
      - BOLT_HOST=0.0.0.0
      - BOLT_PORT=2012
      - BOLT_DATA_DIR=/data
      - BOLT_PERSIST=true
      - BOLT_HIGH_PERF=true
      - BOLT_ADMIN_PASSWORD=admin
      - BOLT_NODE_ID=node1
      - BOLT_CLUSTER_PORT=2013
      - BOLT_CLUSTER_PEERS=node2:bolt-node2:2013,node3:bolt-node3:2013
      - RUST_LOG=info
    networks:
      - bolt_cluster
    restart: unless-stopped

  bolt-node2:
    build: .
    image: bolt:latest
    container_name: bolt-node2
    hostname: bolt-node2
    ports:
      - "2022:2012"   # Client port
      - "2023:2013"   # Cluster port
      - "9092:9091"   # Metrics port
    volumes:
      - bolt_node2_data:/data
    environment:
      - BOLT_HOST=0.0.0.0
      - BOLT_PORT=2012
      - BOLT_DATA_DIR=/data
      - BOLT_PERSIST=true
      - BOLT_HIGH_PERF=true
      - BOLT_ADMIN_PASSWORD=admin
      - BOLT_NODE_ID=node2
      - BOLT_CLUSTER_PORT=2013
      - BOLT_CLUSTER_PEERS=node1:bolt-node1:2013,node3:bolt-node3:2013
      - RUST_LOG=info
    networks:
      - bolt_cluster
    restart: unless-stopped
    depends_on:
      - bolt-node1

  bolt-node3:
    build: .
    image: bolt:latest
    container_name: bolt-node3
    hostname: bolt-node3
    ports:
      - "2032:2012"   # Client port
      - "2033:2013"   # Cluster port
      - "9093:9091"   # Metrics port
    volumes:
      - bolt_node3_data:/data
    environment:
      - BOLT_HOST=0.0.0.0
      - BOLT_PORT=2012
      - BOLT_DATA_DIR=/data
      - BOLT_PERSIST=true
      - BOLT_HIGH_PERF=true
      - BOLT_ADMIN_PASSWORD=admin
      - BOLT_NODE_ID=node3
      - BOLT_CLUSTER_PORT=2013
      - BOLT_CLUSTER_PEERS=node1:bolt-node1:2013,node2:bolt-node2:2013
      - RUST_LOG=info
    networks:
      - bolt_cluster
    restart: unless-stopped
    depends_on:
      - bolt-node1

networks:
  bolt_cluster:
    driver: bridge

volumes:
  bolt_node1_data:
  bolt_node2_data:
  bolt_node3_data:
